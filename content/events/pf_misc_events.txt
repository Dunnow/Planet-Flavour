namespace = pf_misc

# Hive Stars spawn system
system_event = {
	id = pf_misc.100
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		create_species = {
			name = "NAME_Prethoryn"
			class = SWARM
			namelist = Prethoryn
			portrait = random
			traits = random
			immortal = yes

			effect = { save_event_target_as = pf_straggler_prethoryn_species }
		}

		create_country = {
			name = "NAME_pf_straggler_swarms"
			type = pf_straggler_swarm

			flag = {
				icon= {
					category = "special"
					file = "the_swarm.dds"
				}
				background= {
					category = "backgrounds"
					file = "new_dawn.dds"
				}
				colors={
					"grey"
					"orange"
					"null"
					"null"
				}
			}
			effect = {
				set_graphical_culture = swarm_01
				set_country_flag = pf_straggler_swarms
				save_global_event_target_as = pf_straggler_swarms_country
			}
		}

		spawn_system = {
			min_distance >= 90
			max_distance <= 100
			direction = rimwards
			initializer = pf_hive_stars_core_initializer
			hyperlane = no
		}
	}
}

event = {
	id = pf_misc.110
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		random_list = {
			3 = { } # nothing
			1 = {
				random_rim_system = {
					system_event = { id = pf_misc.100 }
				}
			}
		}
	}
}

# Hive Stars spawn system
system_event = {
	id = pf_misc.200
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		# We're on a random system. We need to find the furthest from us.

		spawn_system = {
			min_distance >= 70
			max_distance <= 90
			direction = rimwards
			initializer = pf_ringworld_network_01
			hyperlane = no
			effect = { set_star_flag = pf_first_system }
		}

		last_created_system = {
			save_event_target_as = pf_first_system

			ordered_rim_system = {
				limit = {
					NOT = { has_star_flag = crisis_spawn_exclude}
				}
				position = 0
				order_by = value:pf_star_distance_euclidean
				save_event_target_as = pf_best_candidate
				set_variable = {
					which = pf_galactic_diameter
					value = value:pf_star_distance_euclidean
				}
				log = "[This.GetName] is the best!"
			}

			event_target:pf_best_candidate = {
				set_star_flag = pf_best_candidate
				spawn_system = {
					min_distance >= 70
					max_distance <= 90
					direction = rimwards
					initializer = pf_ringworld_network_01
					hyperlane = no
					effect = {
						set_star_flag = pf_second_system
						save_event_target_as = pf_second_system
					}
				}
			}

			ordered_rim_system = {
				limit = {
					NOT = { has_star_flag = crisis_spawn_exclude}
				}
				position = 0
				inverse = yes
				order_by = value:pf_closeness_to_galactic_hypotenuse
				save_event_target_as = pf_best_hypotenuse_candidate
				set_variable = {
					which = pf_hypotenuse_closeness
					value = value:pf_closeness_to_galactic_hypotenuse
				}
				set_star_flag = pf_best_hypotenuse_candidate

				spawn_system = {
					min_distance >= 70
					max_distance <= 90
					direction = rimwards
					initializer = pf_ringworld_network_01
					hyperlane = no
					effect = {
						set_star_flag = pf_third_system
						save_event_target_as = pf_third_system
					}
				}
			}
			event_target:pf_third_system = {
				ordered_rim_system = {
					limit = {
						NOT = { has_star_flag = crisis_spawn_exclude}
					}
					position = 0
					order_by = value:pf_star_distance_euclidean
					save_event_target_as = pf_best_candidate

					spawn_system = {
						min_distance >= 70
						max_distance <= 90
						direction = rimwards
						initializer = pf_ringworld_network_01
						hyperlane = no
						effect = {
							set_star_flag = pf_fourth_system
							save_event_target_as = pf_fourth_system
						}
					}
				}
			}
		}
	}
}