namespace = pf_content

planet_event = {
    id = pf_content.10
	title = pf_content.10.name
	desc = "pf_content.10.desc"
	picture  = GFX_evt_alien_nature
	location = this
    is_triggered_only = yes

	option = {
		name = pf_content.10.a
		remove_modifier = pf_pm_multi_planetary_ecosystem
	}
}

planet_event = {
    id = pf_content.20
	title = pf_content.20.name
	desc = "pf_content.20.desc"
	picture  = GFX_evt_asteroid_approaching_planet
	location = this
    is_triggered_only = yes

	option = {
		name = pf_content.20.a
		remove_modifier = pf_pm_recent_asteroid_impact
		add_modifier = { modifier = pf_pm_asteroid_impact }
	}
}

ship_event = {
	id = pf_content.100
	title = pf_content.100.name
	desc = "pf_content.100.desc"
	picture  = GFX_evt_infested
	location = this
    is_triggered_only = yes

	trigger = {
		solar_system = {
			has_star_flag = pf_hive_star_system
		}
		owner = {
			not = { has_country_flag = pf_has_encountered_hive_stars}
		}
	}

	immediate = {
		owner = {
			set_country_flag = pf_has_encountered_hive_stars
			establish_communications_no_message = event_target:pf_straggler_swarms_country
		}
	}

	option = {
		name = pf_content.100.a
		owner = {
			add_resource = { society_research = 500 }
		}
	}
}

ship_event = {
	id = pf_content.101
    is_triggered_only = yes
	hide_window = yes

	trigger = {
		solar_system = {
			has_star_flag = pf_hive_star_system
		}
		# From = planet that was surveyed
		from = {
			is_planet_class = pc_infested
		}
	}

	immediate = {
		if = {
			limit = {
				owner = {
					not = { has_country_flag = pf_has_surveyed_hive_star_planet}
				}
			}
			owner = {
				set_country_flag = pf_has_surveyed_hive_star_planet
			}
			solar_system = {
				save_event_target_as = pf_first_hive_star_system_surveyed
			}
		}

		else = {
			if = {
				limit = {
					owner = {
						not = { has_country_flag = pf_has_surveyed_second_hive_star_planet }
					}
				}
				from = {
					save_event_target_as = pf_second_infested_world_surveyed
				}
				ship_event = { id = pf_content.102 }
				owner = {
					set_country_flag = pf_has_surveyed_second_hive_star_planet
				}
			}
		}
	}
}

ship_event = {
	id = pf_content.102
	title = pf_content.102.name
	desc = "pf_content.102.desc"
	picture  = GFX_evt_infested
	location = this
    is_triggered_only = yes

	option = {
		name = pf_content.102.a
		owner = {
			add_resource = { society_research = 500 }
		}
	}
}

planet_event = {
    id = pf_content.110
    hide_window = yes
    is_triggered_only = yes

    immediate = {
		if = {
			limit = {
				has_modifier = unstable_tectonics
			}
			random_list = {
				1 = { planet_event = { id = pf_content.111 }}
				1 = {}
			}
		}
    }
}

planet_event = {
	id = pf_content.111
	title = pf_content.111.name
	desc = pf_content.111.desc
	picture  = GFX_evt_mining_operations
	location = this
    is_triggered_only = yes

	option = {
		name = pf_content.111.a
		allow = {
			owner = {
				resource_stockpile_compare = {
					resource = energy
					value > 2000
				}
			}
		}
		add_deposit = d_pf_geothermic_extraction_sites
	}
	option = {
		name = pf_content.111.b
		hidden_effect = {
			set_planet_flag = pf_geothermic_extraction_decision_allowed
		}
	}
}



# Initial Roll for Static Sandstorm modifiers
planet_event = {
	id = pf_content.120
    hide_window = yes
    is_triggered_only = yes

	immediate = {
		if = {
			limit = {
				OR = {
					is_planet_class = pc_desert
					is_planet_class = pc_arid
					is_planet_class = pc_savannah
				}
			}
			random_list = {
				30 = {}
				1 = {
					planet_event = { id = pf_content.121 }
					modifier = {
						mult = 2
						is_planet_class = pc_arid
					}
					modifier = {
						mult = 3
						is_planet_class = pc_desert
					}
					# Make it a bit kinder for desert dwelling empires
					modifier = {
						mult = 0.75
						is_ideal_planet_class = {
							who = owner
							status = yes
						}
					}
				}
			}
		}
	}
}

# Engine event for static sandstorm world modifiers
planet_event = {
	id = pf_content.121
    hide_window = yes
    is_triggered_only = yes

	immediate = {
		if = {
			# Lets us stop the random event silently when flag is cleared
			limit = { NOT = { has_planet_flag =  pf_removed_static_sandstorm_world } }
			set_planet_flag = pf_static_sandstorm_world
			random_list = {
				50 = { }
				50 = { planet_event = { id = pf_content.122 }}
			}
			# Queue up the next dice roll
			planet_event = { id = pf_content.121 years = 10 }
		}
	}
}

planet_event = {
	id = pf_content.122
	title = pf_content.122.name
	desc = pf_content.122.desc
	picture  = GFX_evt_storm_formation
	location = this
    is_triggered_only = yes

	option = {
		name = pf_content.122.a
		random_list = {
			1 = { add_modifier = { modifier = pf_pm_harsh_static_storms years = 5 } }
			3 = { add_modifier = { modifier = pf_pm_static_storms years = 5 } }
			2 = { add_modifier = { modifier = pf_pm_mild_static_storms years = 5 } }
		}
	}
}

# Check for sandstorm planet and remove effects if planet class has changed
planet_event = {
    id = pf_content.123
    hide_window = yes
    is_triggered_only = yes

    immediate = {
		if = {
			limit = { has_planet_flag = pf_static_sandstorm_world }
			planet_event = { id = pf_content.124 }
		}
    }
}

# Planet class has changed so we remove all the sandstorm nonsense.
planet_event = {
	id = pf_content.124
	title = pf_content.124.name
	desc = pf_content.124.desc
	picture  = GFX_evt_pf_planet_space
	location = this
    is_triggered_only = yes

	immediate = {
		set_planet_flag = pf_removed_static_sandstorm_world
		remove_planet_flag = pf_static_sandstorm_world
	}

	option = {
		name = pf_content.124.a
		if = {
			limit = { has_modifier = pf_pm_harsh_static_storms }
			remove_modifier = pf_pm_harsh_static_storms
		}
		if = {
			limit = { has_modifier = pf_pm_static_storms }
			remove_modifier = pf_pm_static_storms
		}
		if = {
			limit = { has_modifier = pf_pm_mild_static_storms }
			remove_modifier = pf_pm_mild_static_storms
		}
	}
}

# Hyperbloom gatekeeper
planet_event = {
    id = pf_content.130
    hide_window = yes
    is_triggered_only = yes

	trigger = {
		has_modifier = pf_pm_overgrown
	}

    immediate = {
		# Will it trigger at all
		random_list = {
			10 = {}
			5 = {
				# When will the next one trigger
				random_list = {
					1 = { planet_event = { id = pf_content.131 years = 5 }}
					2 = { planet_event = { id = pf_content.131 years = 10 }}
					2 = { planet_event = { id = pf_content.131 years = 15 }}
					1 = { planet_event = { id = pf_content.131 years = 20 }}
				}
			}
		}
    }
}

# Hyperbloom
planet_event = {
    id = pf_content.131
	title = pf_content.131.name
	desc = pf_content.131.desc
	picture  = GFX_evt_alien_nature
	location = this
    is_triggered_only = yes

	trigger = {
		has_modifier = pf_pm_overgrown
	}

    immediate = {
		hidden_effect = {
			# Trigger the next bloom
			random_list = {
				1 = { planet_event = { id = pf_content.131 years = 5 }}
				2 = { planet_event = { id = pf_content.131 years = 10 }}
				2 = { planet_event = { id = pf_content.131 years = 15 }}
				2 = { planet_event = { id = pf_content.131 years = 20 }}
				1 = { planet_event = { id = pf_content.131 years = 25 }}
			}
		}
    }

	option = {
		name = pf_content.131.a
			random_list = {
				1 = { add_modifier = { modifier = pf_pm_hyperbloom years = 5 }}
				1 = { add_modifier = { modifier = pf_pm_hyperbloom years = 10 }}
				1 = { add_modifier = { modifier = pf_pm_hyperbloom years = 15 }}
			}

	}
}

ship_event = {
	id = pf_content.200
	title = pf_content.200.name
	desc = "pf_content.200.desc"
	location = this
    is_triggered_only = yes

	trigger = { from = { has_planet_flag = pf_luxury_resource_homeworld } }

	inline_script = {
		script = planet_flavour/pf_rare_resource_event_picture_art
		PLANET_SCOPE = FROM
	}

	option = {
		name = pf_content.200.a
		owner = {
			add_resource = { society_research = 500 }
		}
	}
}