namespace = pf_core

# Set mod flag
event = {
	id = pf_core.0
	hide_window = yes
	is_triggered_only = yes
	fire_only_once = yes
	immediate = { set_global_flag = planet_flavour_is_active }
}

# Add extraterrestrial life modifier
event = {
    id = pf_core.10
	hide_window = yes
	is_triggered_only = yes

	immediate = {
        every_system = {
            limit = {
                NOT = {
                    has_star_flag = home_system
                }
                count_system_planet = {
                    limit = {
                        pf_is_valid_planet_for_extraplanetary_life = yes
                    }
                    count > 1
                }
            }
            every_system_planet = {
                limit = {
                    pf_is_valid_planet_for_extraplanetary_life = yes
                }
                add_modifier = { modifier = pf_pm_extraplanetary_life }
            }
        }
    }
}

# Add planetary rings modifier
event = {
    id = pf_core.11
	hide_window = yes
	is_triggered_only = yes

	immediate = {
        every_system = {
            limit = {
                any_system_planet = {
                    has_ring = yes
                }
            }
            every_system_planet = {
                limit = { has_ring = yes }
                add_modifier = { modifier = pf_pm_planetary_rings }
            }
        }
    }
}

# Terraforming cleanup
planet_event = {
    id = pf_core.20
    hide_window = yes
    is_triggered_only = yes

    immediate = {
        # Always change these
        remove_modifier = pf_pm_swamp_world
        remove_modifier = pf_pm_dry_world
        remove_modifier = pf_pm_equatorial_deserts
        # Changed to a wet world
        if = {
            limit = { is_wet = yes }
            remove_modifier = pf_pm_ice_age
            remove_modifier = pf_pm_severe_droughts
            remove_modifier = pf_pm_toxic_spores
            remove_modifier = pf_pm_canyon_world
            
            remove_modifier = pf_pm_snowball_world
            remove_modifier = pf_pm_bone_world
            remove_modifier = pf_pm_abundant_parasites
        }
        # Changed to a dry world
        if = {
            limit = { is_dry = yes }
            remove_modifier = pf_pm_ice_age
            remove_modifier = pf_pm_biocrystals
            remove_modifier = pf_pm_floral_world
            remove_modifier = pf_pm_fungal_world

            remove_modifier = pf_pm_tidal_surges
            remove_modifier = pf_pm_toxic_spores
            remove_modifier = pf_pm_snowball_world
            remove_modifier = pf_pm_bone_world

            remove_modifier = pf_pm_megacoral_reefs
            remove_modifier = pf_pm_bioluminescent_flora
            remove_modifier = pf_pm_abundant_parasites
            remove_modifier = pf_pm_tropical_archipelagos

            remove_modifier = pf_pm_volcanic_soils
            remove_modifier = pf_pm_arboreal_ecosystem
            remove_modifier = pf_pm_abyssal_seas
        }

        # Changed to a cold world
        if = {
            limit = { is_cold = yes }
            remove_modifier = pf_pm_biocrystals
            remove_modifier = pf_pm_floral_world

            remove_modifier = pf_pm_tidal_surges
            remove_modifier = pf_pm_toxic_spores
            remove_modifier = pf_pm_snowball_world
            remove_modifier = pf_pm_bone_world

            remove_modifier = pf_pm_megacoral_reefs
            remove_modifier = pf_pm_abundant_parasites
            remove_modifier = pf_pm_tropical_archipelagos
            remove_modifier = pf_pm_canyon_world

            remove_modifier = pf_pm_severe_droughts
            remove_modifier = pf_pm_arboreal_ecosystem

            if = {
                limit = { NOT = { is_planet_class = pc_arctic}}
                remove_modifier = pf_pm_snowball_world
            }
        }
    }
}
# Terraforming to worlds with no / limited biosphere.
planet_event = {
    id = pf_core.21
    hide_window = yes
    is_triggered_only = yes

    # Remove ALL nature modifiers
    immediate = {
        if = {
            limit = {
                OR = {
                    is_planet_class = pc_city
                    is_planet_class = pc_machine
                    is_planet_class = pc_hive
                    is_planet_class = pc_nanotech
                    is_planet_class = pc_nuked
                    is_artificial = yes
                    AND = {
                        is_colony = no
                        is_colonizable = no
                    }
                }
            }
            if = {
                limit = {
                    # Going "up" a tier so we remove more negative modifiers
                    OR = {
                        is_planet_class = pc_city
                        is_planet_class = pc_machine
                        is_planet_class = pc_hive
                        is_planet_class = pc_nanotech
                        is_artificial = yes
                    }
                }
                remove_modifier = pf_pm_irradiated_world
                remove_modifier = pf_pm_severe_droughts
                remove_modifier = pf_pm_harsh
            }
            if = {
                limit = {
                    # Going "down" a tier, so we remove more positive modifiers
                    OR = {
                        is_planet_class = pc_nuked
                        AND = {
                            is_colony = no
                            is_colonizable = no
                        }
                    }
                }
                remove_modifier = pf_pm_extraplanetary_life
            }
            remove_modifier = pf_pm_ice_age
            remove_modifier = pf_pm_floral_world
            remove_modifier = pf_pm_biocrystals
            remove_modifier = pf_pm_overgrown

            remove_modifier = pf_pm_floating_rocks
            remove_modifier = pf_pm_tidal_surges
            remove_modifier = pf_pm_fungal_world
            remove_modifier = pf_pm_megacoral_reefs

            remove_modifier = pf_pm_bioluminescent_flora
            remove_modifier = pf_pm_toxic_spores
            remove_modifier = pf_pm_abundant_parasites
            remove_modifier = pf_pm_tropical_archipelagos

            remove_modifier = pf_pm_snowball_world
            remove_modifier = pf_pm_volcanic_soils
            remove_modifier = pf_pm_chirping_plains
            remove_modifier = pf_pm_bone_world

            remove_modifier = pf_pm_abyssal_seas
            remove_modifier = pf_pm_subglacial_seas
        }
    }
}

# Multi planet ecosystem handling
# Doing it seperate since it's a little bit more extra stuff
planet_event = {
    id = pf_core.22
    hide_window = yes
    is_triggered_only = yes

    immediate = {
        # Multi planetary ecosystem
        if = {
            limit = {
                NOR = {
                    is_planet_class = pc_tropical
                    is_planet_class = pc_gaia
                }
            }
            remove_modifier = pf_pm_multi_planetary_ecosystem
            # If only one other world has tropical or gaia, we want to remove the modifier from it too as it's no longer multiplanetary.
            if = {
                limit = {
                    solar_system = {
                        count_system_planet = {
                            count = 1
                            limit = {
                                has_modifier = pf_pm_multi_planetary_ecosystem
                            }
                        }
                    }
                }
                solar_system = {
                    random_system_planet = {
                        limit = { has_modifier = pf_pm_multi_planetary_ecosystem}
                        planet_event = { id = pf_core.23 }
                    }
                }
            }
        }
    }
}

planet_event = {
    id = pf_core.23
	title = pf_core.23.name
	desc = "pf_core.23.desc"
	picture  = GFX_evt_alien_nature
	location = this
    is_triggered_only = yes

	option = {
		name = pf_core.23.a
		remove_modifier = pf_pm_multi_planetary_ecosystem
	}
}

# Add dry world modifier effects
event = {
    id = pf_core.30
	hide_window = yes
	is_triggered_only = yes

	immediate = {
        every_system = {
            limit = {
                any_system_planet = {
                    has_modifier = pf_pm_dry_world
                }
            }
            every_system_planet = {
                limit = { has_modifier = pf_pm_dry_world }
                set_planet_flag = pf_dry_world
                set_planet_entity = {
                    entity = planet_flavour_dry_desert_planet_entity
                }
            }
        }
    }
}

# Add swamp world modifier effects
event = {
    id = pf_core.31
	hide_window = yes
	is_triggered_only = yes

	immediate = {
        every_system = {
            limit = {
                any_system_planet = {
                    has_modifier = pf_pm_swamp_world
                }
            }
            every_system_planet = {
                limit = { has_modifier = pf_pm_swamp_world }
                set_planet_flag = pf_swamp_world
                while = {
                    count = 4
                    add_deposit = d_noxious_swamp
                }
                add_deposit = d_bubbling_swamp
            }
        }
    }
}
